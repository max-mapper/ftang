<!DOCTYPE html>
<html lang="en">
<head>

	<title>MUSIC POUCH</title>
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width; initial-scale=1;"> 
    
	<link rel="stylesheet" href="css/bootstrap.min.css">
	<style type="text/css">
  	html, body { height: 100%; background: #f0f0f0 url(img/bg.png) }
	  .artists, h1 { margin: 10px; list-style: none; }
	  li { line-height: 22px; font-size: 22px; cursor: hand; cursor: pointer;  }
	  li:hover { font-weight: bold; color: salmon;}
	  .selected { font-weight: bold}
	</style>
    
  <script type="text/javascript">
    var app = {};
  </script>   
  <script type="text/javascript" src="js/underscore-min.js"></script>
  <script type="text/javascript" src="js/jquery-1.6.2.min.js"></script>
  <script type="text/javascript" src="js/jquery.mustache.js"></script>
  <script type="text/javascript" src="js/jquery.couch2.js"></script>
  <script type="text/javascript" src="js/jquery.url.js"></script>
  <script type="text/javascript" src="js/quicktime-embed.js"></script>
  <script type="text/javascript">

    function addPlayer(artist) {
      couch.request({url: app.baseURL + 'api/artist/' + artist}).then(function(songs) {
        $('.artists').html("");
        var i = 1
          , playlist = []
          ;
        _(_.rest(songs.rows)).each(function(song) {
          playlist.push({id: i, url: song.doc.url});
          i++;
        })
        var script = $("<script />", {
          html: $.mustache( $( ".scriptTemplate" ).html(), {href: _.first(songs.rows).doc.url, songs: playlist} )
        })
        $(".artists").html(script)
      })
    }

    $(function() {
      app.baseURL = '/';
      couch.request({url: app.baseURL + 'api/artists'}).then(function(artists) {
        app.artists = artists.rows;
        _(app.artists).each(function(artist) {
          $('.artists').append('<li>' + artist.key + '</li>');
        })
        
        $('.artists li').click(function(e) {
          var artist = $(e.target).text();
          addPlayer(artist);
        })
      })
    })
	</script>
	
</head>
	
<body>  
  <body>
    <div class="artistList">
      <h1>AWWWW YEAHHHH</h1>
      <ul class="artists"></ul>
    </div>
  </body>
  <script type="text/mustache" class="scriptTemplate">
  //<![CDATA[
    QT_WriteOBJECT(
      'play.gif','305','305',''
    , 'controller','true'
    , 'scale','aspect'
    , 'target','myself'
    , 'href',"{{href}}"
    , 'autoplay','true'
    , 'loop','true'
    , 'type','audio/mp3'
  {{#songs}}
  , 'qtnext{{id}}',"<{{url}}>T<myself>"
  {{/songs}}
    );
  //]]>
  </script>
  
</body>
</html>